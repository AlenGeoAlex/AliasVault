@page "/"
@page "/aliases"
@using AliasVault.WebApp.Components.Alias
@using AliasVault.WebApp.Services
@inject AliasService AliasService
@inherits PageBase

<LayoutPageTitle>Home</LayoutPageTitle>

<div class="grid grid-cols-1 px-4 pt-6 xl:grid-cols-3 xl:gap-4 dark:bg-gray-900">
    <div class="mb-4 col-span-full xl:mb-2">
        <Breadcrumb BreadcrumbItems="BreadcrumbItems" />
        <h1 class="text-xl font-semibold text-gray-900 sm:text-2xl dark:text-white">Aliases</h1>
        <p>Find all of your aliases below.</p>
    </div>
</div>

@if (IsLoading)
{
    <LoadingIndicator />
}

<div class="grid gap-4 px-4 mb-4 md:grid-cols-4 xl:grid-cols-6">
    @foreach (var alias in Aliases)
    {
        <Alias Obj="@alias"/>
    }
</div>

@code {
    private bool IsLoading { get; set; } = true;
    private List<Shared.Models.WebApi.AliasListEntry> Aliases { get; set; } = new();

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await LoadAliasesAsync();
        }
    }

    private async Task LoadAliasesAsync()
    {
        IsLoading = true;
        StateHasChanged();

        // Load the aliases from the webapi via AliasService.
        Aliases = await AliasService.GetListAsync();

        IsLoading = false;
        StateHasChanged();
    }
}
