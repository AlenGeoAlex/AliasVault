@page "/emails"

<PageTitle>Emails</PageTitle>

<h1>Emails</h1>

@if (IsLoading)
{
    <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
    </div>
}
else
{
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 row-cols-xl-4 g-4">
        @foreach (var email in EmailList)
        {
            <div>
                <div>@email.From</div>
                <div>@email.MessagePreview</div>
            </div>
        }
    </div>
}

@code {
    private bool IsLoading { get; set; } = true;
    private List<Email> EmailList { get; set; } = new List<Email>();

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await LoadAliasesAsync();
        }
    }

    private async Task LoadAliasesAsync()
    {
        IsLoading = true;
        StateHasChanged();

        // Load the aliases from the database.
        var user = UserService.User();
        EmailList = await DbContext.Emails
            .ToListAsync();

        IsLoading = false;
        StateHasChanged();
    }
}
