@page "/user/logout"
@attribute [AllowAnonymous]
@layout Auth.Layout.MainLayout
@inject AuthenticationStateProvider AuthStateProvider
@inject NavigationManager NavigationManager
@inject AuthService AuthService
@inject GlobalNotificationService GlobalNotificationService
@inject DbService DbService

<div class="text-center">
    <BoldLoadingIndicator />
    <h2 class="mt-4 text-xl font-semibold text-gray-900 dark:text-white">Logging out...</h2>
</div>

@code {
    /// <inheritdoc />
    protected override async Task OnInitializedAsync()
    {
        await Task.Delay(500);

        await base.OnInitializedAsync();
        await AuthService.RemoveTokensAsync();
        AuthService.RemoveEncryptionKey();
        await AuthStateProvider.GetAuthenticationStateAsync();

        // Initialize a new empty database to clear all data.
        DbService.InitializeEmptyDatabase();
        GlobalNotificationService.ClearMessages();

        // Redirect to home page
        NavigationManager.NavigateTo("/");
    }
}
